<div
    class="min-h-screen bg-[#f8fafc] pb-24 relative overflow-hidden font-sans selection:bg-indigo-500 selection:text-white">
    <div
        class="absolute top-0 left-0 w-full h-[500px] bg-gradient-to-b from-indigo-100/50 via-slate-50/50 to-transparent -z-10">
    </div>
    <div
        class="absolute -top-40 -right-40 w-[600px] h-[600px] bg-indigo-200/30 rounded-full blur-[120px] -z-10 animate-pulse">
    </div>

    <nav
        class="sticky top-6 mx-4 lg:mx-auto max-w-7xl rounded-2xl z-50 px-6 py-4 flex justify-between items-center bg-white/70 backdrop-blur-xl border border-white/80 shadow-[0_8px_30px_rgb(0,0,0,0.04)] transition-all">
        <button routerLink="/customer/dashboard"
            class="group flex items-center gap-3 text-slate-600 font-bold hover:text-indigo-600 transition-colors cursor-pointer">
            <div
                class="w-10 h-10 rounded-xl bg-slate-100 group-hover:bg-indigo-50 flex items-center justify-center transition-colors shadow-inner">
                <i class="bi bi-arrow-left text-lg group-hover:-translate-x-1 transition-transform"></i>
            </div>
            <span class="tracking-tight hidden md:block">Volver a mi Cartera</span>
        </button>

        <div class="flex items-center gap-3 px-4 py-2 bg-emerald-50 rounded-xl border border-emerald-100/50">
            <span class="relative flex h-2.5 w-2.5">
                <span
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
            </span>
            <span class="text-[10px] font-black uppercase tracking-[0.2em] text-emerald-600">Conexión Segura</span>
        </div>
    </nav>

    @if (isLoading) {
    <div class="flex flex-col justify-center items-center py-40 gap-6">
        <div class="relative w-20 h-20">
            <div class="absolute inset-0 border-4 border-indigo-100 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-indigo-600 rounded-full border-t-transparent animate-spin">
            </div>
        </div>
        <p class="text-indigo-400 font-black animate-pulse uppercase tracking-[0.3em] text-xs">Sincronizando Tienda...
        </p>
    </div>
    } @else {
    <main class="max-w-7xl mx-auto px-6 mt-10 animate-fade-in-up">

        <div
            class="relative h-[350px] md:h-[450px] rounded-[3rem] overflow-hidden shadow-2xl shadow-indigo-200/20 mb-16 group border border-white/50 flex items-end bg-slate-800">
            <img [src]="store?.imageUrl || 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2070&auto=format&fit=crop'"
                (error)="$any($event.target).src = 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2070&auto=format&fit=crop'"
                class="absolute inset-0 w-full h-full object-cover transition-transform duration-[2000ms] group-hover:scale-105"
                alt="Banner Tienda">
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/10 to-transparent"></div>
            <div class="relative z-10 p-8 md:p-14 w-full">
                <span
                    class="inline-flex items-center gap-2 px-4 py-1.5 bg-black/30 backdrop-blur-xl text-white text-[10px] font-black rounded-lg uppercase tracking-[0.2em] border border-white/30 shadow-lg mb-4">
                    <i class="bi bi-star-fill text-indigo-400"></i> Tienda Oficial
                </span>
                <h1 class="text-5xl md:text-8xl font-black text-white tracking-tighter drop-shadow-xl mb-2">
                    {{ store?.name }}
                </h1>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">

            <div class="lg:col-span-4 space-y-6">
                <div class="sticky top-32 space-y-6">

                    <div
                        class="relative bg-gradient-to-br from-slate-900 via-[#0f172a] to-slate-950 rounded-[2.5rem] p-10 shadow-2xl shadow-slate-900/20 overflow-hidden border border-slate-800 group">
                        <div
                            class="absolute -right-20 -top-20 w-64 h-64 bg-indigo-500/20 rounded-full blur-[80px] group-hover:bg-indigo-500/30 transition-colors duration-700">
                        </div>

                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-10">
                                <p class="text-slate-400 text-[10px] font-black uppercase tracking-[0.3em]">Tu Saldo
                                    Actual</p>
                                <i class="bi bi-wallet2 text-slate-500 text-xl"></i>
                            </div>

                            <div class="flex items-baseline gap-2 mb-12">
                                <h2
                                    class="text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-400 tracking-tighter drop-shadow-lg">
                                    {{ loyaltyCard?.currentBalance || 0 }}</h2>
                                <span class="text-indigo-400 font-bold text-xl uppercase tracking-widest">pts</span>
                            </div>

                            <div class="flex flex-col gap-3">
                                <button (click)="openQrModal()"
                                    class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl text-sm font-black uppercase tracking-widest transition-all flex items-center justify-center gap-3 shadow-lg shadow-indigo-500/20 hover:scale-[1.02] active:scale-95">
                                    <i class="bi bi-qr-code-scan text-lg"></i> Identificarme
                                </button>

                                <button routerLink="/customer/my-points" [queryParams]="{ cardId: cardId }"
                                    class="w-full py-4 bg-white/10 hover:bg-white/20 text-white rounded-2xl text-sm font-black uppercase tracking-widest backdrop-blur-md transition-all flex items-center justify-center gap-3 border border-white/10 hover:scale-[1.02] active:scale-95">
                                    <i class="bi bi-clock-history text-lg"></i> Ver Historial
                                </button>
                            </div>
                        </div>
                    </div>

                    <div
                        class="bg-white rounded-[2.5rem] border border-slate-200 shadow-sm p-8 hover:shadow-lg transition-shadow">
                        <h4 class="font-black text-slate-900 uppercase text-xs tracking-widest mb-6">Información del
                            Local</h4>
                        <ul class="space-y-6">
                            <li class="flex items-center gap-5">
                                <div
                                    class="w-12 h-12 rounded-2xl bg-indigo-50 text-indigo-500 flex items-center justify-center shrink-0 shadow-inner">
                                    <i class="bi bi-tag-fill text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-0.5">
                                        Categoría</p>
                                    <p class="text-sm font-black text-slate-800">{{ store?.category || 'No especificada'
                                        }}</p>
                                </div>
                            </li>
                            <li class="flex items-center gap-5">
                                <div
                                    class="w-12 h-12 rounded-2xl bg-indigo-50 text-indigo-500 flex items-center justify-center shrink-0 shadow-inner">
                                    <i class="bi bi-geo-alt-fill text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-0.5">
                                        Dirección</p>
                                    <p class="text-sm font-black text-slate-800">{{ store?.address || 'No especificada'
                                        }}</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8">
                <div class="flex flex-col md:flex-row md:items-end justify-between mb-10 gap-4">
                    <div>
                        <span
                            class="text-indigo-600 text-[10px] font-black uppercase tracking-[0.3em] mb-2 block">Catálogo
                            Exclusivo</span>
                        <h3 class="text-4xl md:text-5xl font-black text-slate-900 tracking-tight">Recompensas</h3>
                    </div>
                    <div
                        class="px-5 py-2 bg-white text-slate-600 text-xs font-black rounded-xl uppercase tracking-widest border border-slate-200 shadow-sm">
                        {{ rewards.length }} Disponibles
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    @for (reward of rewards; track reward.id) {
                    <div
                        class="group bg-white rounded-[2.5rem] border border-slate-200 p-5 transition-all duration-500 hover:shadow-2xl hover:shadow-indigo-500/10 hover:-translate-y-2 hover:border-indigo-200 flex flex-col h-full">
                        <div class="relative h-56 rounded-[2rem] overflow-hidden mb-6 bg-slate-100">
                            <img [src]="reward.imageUrl || 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=2040&auto=format&fit=crop'"
                                (error)="$any($event.target).src = 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=2040&auto=format&fit=crop'"
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                [alt]="reward.name">
                            <div
                                class="absolute top-4 right-4 px-4 py-2 bg-white/90 backdrop-blur-md shadow-lg rounded-xl border border-white/50">
                                <p class="text-slate-900 font-black text-lg tracking-tighter leading-none">{{
                                    reward.pointsCost }} <span
                                        class="text-[10px] text-slate-500 uppercase tracking-widest">pts</span></p>
                            </div>
                        </div>

                        <div class="px-2 flex-1 flex flex-col">
                            <h4
                                class="text-2xl font-black text-slate-900 mb-2 tracking-tight group-hover:text-indigo-600 transition-colors">
                                {{ reward.name }}</h4>
                            <p class="text-sm text-slate-500 mb-8 line-clamp-3 leading-relaxed font-medium flex-1">{{
                                reward.description }}</p>

                            <button (click)="redeemReward(reward)"
                                [disabled]="(loyaltyCard?.currentBalance || 0) < reward.pointsCost"
                                class="w-full py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all duration-300 flex items-center justify-center gap-3 border"
                                [ngClass]="(loyaltyCard?.currentBalance || 0) >= reward.pointsCost
                                            ? 'bg-slate-900 border-slate-900 text-white hover:bg-indigo-600 hover:border-indigo-600 shadow-lg shadow-slate-900/20 active:scale-[0.98]'
                                            : 'bg-slate-50 border-slate-200 text-slate-400 cursor-not-allowed'">
                                @if ((loyaltyCard?.currentBalance || 0) >= reward.pointsCost) {
                                <span>Canjear Premio</span>
                                <i class="bi bi-arrow-right text-lg leading-none"></i>
                                } @else {
                                <i class="bi bi-lock-fill text-sm leading-none text-slate-300"></i>
                                <span>Faltan {{ reward.pointsCost - (loyaltyCard?.currentBalance || 0) }} pts</span>
                                }
                            </button>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </main>
    }
</div>

@if (showQrModal) {
<div class="fixed inset-0 z-[100] flex items-center justify-center p-6 animate-fade-in">
    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-md" (click)="closeQrModal()"></div>

    <div class="relative bg-white w-full max-w-sm rounded-[3rem] p-10 shadow-2xl animate-zoom-in overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-emerald-500"></div>

        <button (click)="closeQrModal()"
            class="absolute top-6 right-6 text-slate-400 hover:text-slate-900 transition-colors">
            <i class="bi bi-x-lg text-xl"></i>
        </button>

        <div class="text-center space-y-8">
            <div>
                <span class="text-indigo-600 text-[10px] font-black uppercase tracking-[0.3em] block mb-2">{{
                    store?.name }}</span>
                <h3 class="text-3xl font-black text-slate-900 tracking-tight">Escanea en Caja</h3>
            </div>

            <div class="bg-slate-50 p-6 rounded-[2.5rem] inline-block border border-slate-100 shadow-inner">
                <qrcode [qrdata]="qrPayload" [width]="200" [errorCorrectionLevel]="'M'" [colorDark]="'#0f172a'"
                    [margin]="2">
                </qrcode>
            </div>

            <div class="bg-indigo-50 p-5 rounded-2xl border border-indigo-100/50">
                <p class="text-sm font-black text-indigo-900 mb-1">{{ store?.name }}</p>
                <p class="text-[10px] text-indigo-400 font-bold uppercase tracking-widest">
                    Ticket de Fidelización
                </p>
            </div>
        </div>
    </div>
</div>
}